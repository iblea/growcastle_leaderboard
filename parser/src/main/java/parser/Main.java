/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package parser;

import org.apache.commons.lang3.ObjectUtils.Null;
import org.telegram.telegrambots.longpolling.TelegramBotsLongPollingApplication;
import org.telegram.telegrambots.meta.exceptions.TelegramApiException;

// import org.telegram.telegrambots.meta.TelegramBotsApi;
// import org.telegram.telegrambots.meta.exceptions.TelegramApiException;
// import org.telegram.telegrambots.updatesreceivers.DefaultBotSession;

import parser.db.Database;
import parser.parser.ParseSchedular;
import parser.telegram.TelegramBot;

public class Main {

    public static void main(String[] args)
        throws NullPointerException, TelegramApiException, InterruptedException
    {
        TelegramBotsLongPollingApplication botsApplication = new TelegramBotsLongPollingApplication();

        Database db = new Database("growcastle");
        db.connectEntityManagerFactory();

        TelegramBot telegramBot = new TelegramBot(db, "telegram");
        botsApplication.registerBot(telegramBot.getAPIBotToken(), telegramBot);
        System.out.println("TelegramBot successfully started!");

        // telegramBot.sendMsg("connect success");
        // System.out.println("msg send success!");


        // Parse Schedular
        ParseSchedular schedular = new ParseSchedular();
        // ParseSchedular schedular = new ParseSchedular(30, 1);
        schedular.start();
        System.out.println("start parse schedular");

        // 모든 작업이 끝나면 아래 내용 진행
        Thread.currentThread().join();
        // Thread.sleep(1000);

        // Ensure this process wait forever
        try {
            botsApplication.close();
            System.out.println("disconnect Telegram");
        } catch (Exception e) {
            e.printStackTrace();
        }
        db.disconnectEntityManagerFactory();
        System.out.println("disconnect Database");

    }

}
